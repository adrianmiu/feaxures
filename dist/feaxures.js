!function(a,b){"function"==typeof define&&define.amd?define("feaxures",function(){return a.Feaxures=b(),a.Feaxures}):a.Feaxures=b()}(this,function(){"use strict";var StringProto=String.prototype,ArrayProto=Array.prototype,ObjectProto=Object.prototype,slice=ArrayProto.slice,nativeForEach=ArrayProto.forEach,jQuery=window.jQuery,each=function(a,b,c){if(null!==a)if(nativeForEach&&a.forEach===nativeForEach)a.forEach(b,c);else if(a.length===+a.length){for(var d=0,e=a.length;e>d;d++)if(b.call(c,a[d],d,a)==={})return}else for(var f in a)if(ObjectProto.hasOwnProperty.call(a,f)&&b.call(c,a[f],f,a)==={})return},trim=function(a){return StringProto.trim?StringProto.trim.call(a):a.replace(/^\s\s*/,"").replace(/\s\s*$/,"")},globalEval=function(a){a=trim(a),a&&(window.execScript||function(a){window.eval.call(window,a)})(a)},isObject=function(a){return a===Object(a)},isArray=Array.isArray||function(a){return"[object Array]"==toString.call(a)},extend=function(a){return each(slice.call(arguments,1),function(b){if(b)for(var c in b)a[c]=b[c]}),a},getData=function(a,b){return a&&a.nodeType&&b?a[b]||null:null},setData=function(a,b,c){a&&a.nodeType&&b&&(a[b]=c)},getAttr=function(a,b){return a&&a.nodeType&&b?a.getAttribute(b):null},ErrorFactory=function(a){return function(){throw new Error(a)}},EventsBehaviour;jQuery&&jQuery.Callbacks&&(EventsBehaviour=function(){var a={},b=function(b){return a[b]||(a[b]=jQuery.Callbacks("unique stopOnFalse"))};this.on=function(a,c){return b(a).add(c),this},this.one=function(a,b){var c=this,d=function(){return c.off(a,d),b.apply(this,arguments)};return this.on(a,d),this},this.off=function(a,c){return b(a).remove(c),this},this.trigger=function(a){return b(a).fireWith(this,[].slice.call(arguments))}});var deps={};deps.loader=window.require,deps.Deferred=jQuery?jQuery.Deferred:null,deps.domReady=jQuery?function(a){jQuery(a)}:null,deps.selector=jQuery?function(a,b){return jQuery(a,b)}:null,deps.bindEvent=jQuery?function(a,b,c){return jQuery(a).on(b,c)}:null,deps.unbindEvent=jQuery?function(a,b,c){return jQuery(a).off(b,c)}:null,deps.triggerEvent=jQuery?function(a,b,c){return jQuery(a).trigger(b,c)}:null,deps.delegateEvent=jQuery?function(a,b,c,d){return jQuery(a).on(b,c,d)}:null,deps.undelegateEvent=jQuery?function(a,b,c,d){return jQuery(a).off(b,c,d)}:null,deps.EventsBehaviour=EventsBehaviour,deps=extend(deps,window.FeaxuresDependencies||{});var parseQueryString=function(a,b){var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r=String(a).replace(/^&/,"").replace(/&$/,"").split("&"),s=r.length,t=function(a){return decodeURIComponent(a.replace(/\+/g,"%20"))};for(b||(b=this.window),c=0;s>c;c++){for(l=r[c].split("="),m=t(l[0]),n=l.length<2?"":t(l[1]),"true"===n?n=!0:"false"===n?n=!1:n==parseInt(n,10)?n=parseInt(n,10):n==parseFloat(n)&&(n=parseFloat(n));" "===m.charAt(0);)m=m.slice(1);if(m.indexOf("\x00")>-1&&(m=m.slice(0,m.indexOf("\x00"))),m&&"["!==m.charAt(0)){for(p=[],o=0,d=0;d<m.length;d++)if("["!==m.charAt(d)||o){if("]"===m.charAt(d)&&o&&(p.length||p.push(m.slice(0,o-1)),p.push(m.substr(o,d-o)),o=0,"["!==m.charAt(d+1)))break}else o=d+1;for(p.length||(p=[m]),d=0;d<p[0].length&&(k=p[0].charAt(d),(" "===k||"."===k||"["===k)&&(p[0]=p[0].substr(0,d)+"_"+p[0].substr(d+1)),"["!==k);d++);for(h=b,d=0,q=p.length;q>d;d++)if(m=p[d].replace(/^['"]/,"").replace(/['"]$/,""),i=d!==p.length-1,g=h,""!==m&&" "!==m||0===d)h[m]===j&&(h[m]={}),h=h[m];else{e=-1;for(f in h)h.hasOwnProperty(f)&&+f>e&&f.match(/^\d+$/g)&&(e=+f);m=e+1}g[m]=n}}},Feaxures=function(a){return this._loadedFeatures={},this._features={},this._config={},this.config(a),this.initialize(),this},FeaxuresProto=Feaxures.prototype;return deps.EventsBehaviour.call(FeaxuresProto),FeaxuresProto.config=function(a){if("string"==typeof a){if(1===arguments.length)return this._config[a]||!1;this._config[a]=arguments[1]}else{if(void 0===a)return this._config;this._config=extend(this._config,a)}return this},FeaxuresProto.log=function(){this.config("debug")&&"function"==typeof console.log&&console.log.apply(console,arguments)},FeaxuresProto.isRegistered=function(a){return a&&this._features[a]?!0:!1},FeaxuresProto.register=function(a,b){b=extend({autoLoad:!1,selector:"[data-fxr-"+a+"]",files:[],defaults:{},attachEvent:"domready",attachCondition:!0,detach:null,onLoad:null,onLoadError:null,onAttach:null,onDetach:null},b,{name:a}),"function"==typeof b.onLoad&&this.on("load:"+a,b.onLoad),"function"==typeof b.onLoadError&&this.on("loadError:"+a,b.onLoadError),"function"==typeof b.onAttach&&this.on("attach:"+a,b.onAttach),"function"==typeof b.onDetach&&this.on("detach:"+a,b.onDetach),this._features[a]=b},FeaxuresProto.isLoaded=function(a){return this._loadedFeatures[a]?!0:!1},FeaxuresProto.load=function(a,b){var c=this,d=new deps.Deferred;if(!this.isRegistered(a))return this.log("Feaxure "+a+" is not registered"),d.rejectWith(c,["Feaxure "+a+" is not registered"]),d.promise();var e=this._features[a];return"function"==typeof e.files&&(e.files=e.files.call(this)),isArray(e.files)?("function"==typeof b&&d.done(b),this._loadedFeatures[a]===!0?(d.resolveWith(c),d.promise()):this._loadedFeatures[a]===!1?(d.rejectWith(c),d.promise()):(d.done(function(){if(this._loadedFeatures[a]!==!0){this._loadedFeatures[a]=!0,c.log("Feaxure "+a+" was loaded");var b={feature:a};c.trigger("load",b),c.trigger("load:"+a,b)}}),d.fail(function(){if(this._loadedFeatures[a]!==!1){this._loadedFeatures[a]=!1,c.log("Error loading feaxure "+a);var b={feature:a};c.trigger("loadError",b),c.trigger("loadError:"+a,b)}}),deps.loader(e.files,function(){d.resolveWith(c,["Feaxure "+a+" was loaded"])},function(b){c.log("Error loading feaxure "+a,b),d.rejectWith(c,[b])}),d.promise())):(this.log('The feaxure "'+a+'" does not have a valid list of dependencies'),d.rejectWith(c,['The feaxure "'+a+'" does not have a valid list of dependencies']),d.promise())},FeaxuresProto._detachFromElement=function(a,b){var c=this,d=($(b),this._features[a]),e=!1;if(e="function"==typeof d.attachCondition&&"function"==typeof d.detach&&d.attachCondition.call(d,b)===!1){d.detach.call(this,b),setData(b,"fxr."+a,null),this.log("Feaxure "+a+" was applied to element",b),deps.unbindEvent("body","dom:changed",function(){c._detachFromElement(a,b)});var f={feature:a,element:b};this.trigger("detach:"+a,f),this.trigger("detach",f)}},FeaxuresProto._attachToElement=function(a,b){var c=this,d=this._features[a],e="function"==typeof d.defaults?d.defaults.call(c,b):d.defaults,f=getAttr(b,"data-fxr-"+a),g=null!==getData(b,"fxr."+a)&&void 0!==getData(b,"fxr."+a);if(!g){var h="function"==typeof d.attachCondition?d.attachCondition.call(d,b):d.attachCondition,i="function"==typeof d.attachCondition&&"function"==typeof d.detach;if(h&&(f=this.getFeatureOptionsForElement(a,b),f!==!1)){f=extend({},e,f),d.attach.call(this,b,f),setData(b,"fxr."+a,f),this.log("Feaxure "+a+" was applied to element",b),i&&deps.bindEvent("body","dom:changed",function(){c._detachFromElement(a,b)});var j={feature:a,element:b,options:f};this.trigger("attach:"+a,j),this.trigger("attach",j)}}},FeaxuresProto.attach=function(a,b){var c=this,d=this._features[a],e=0,f=this.load(a),g=new deps.Deferred;return d.attach&&"function"==typeof d.attach?!b.length||b.length<1?(g.done(function(a){c.log(a)}),g.resolve('Feaxure "'+a+'" has no elements to be applied to.'),g.promise()):(each(b,function(b){var d=c.getFeatureOptionsForElement(a,b);d!==!1&&e++}),0===e?(g.done(function(a){c.log(a)}),g.resolveWith(c,['Feaxure "'+a+'" has no elements to be applied to.']),g.promise()):(f.done(function(){each(b,function(b){c._attachToElement(a,b)}),g.resolveWith(c,[{feaxureName:a}])}),g.promise())):(g.fail(function(a){c.log(a)}),g.rejectWith(c,['Feaxure "'+a+'" does not have an attach() method.']),g.promise())},FeaxuresProto.getFeatureOptionsForElement=function(feature,domElement){var options=getAttr(domElement,"data-fxr-"+feature);if("false"===options)return!1;if("true"===options||""===options||null===options)return{};if("#"==options.substr(0,1)&&(options=deps.selector(options).text()),options=trim(options),"{"==options.substr(0,1)){var o={};eval("o = "+options+";"),options=o}else if("function"==options.substr(0,8)){var funcName="_tmpFunc"+Math.floor(1e6*Math.random());if(globalEval("var "+funcName+" = "+options),"function"!=typeof window[funcName])return self.log("value could not be converted into a function: "+options),!1;options=window[funcName].call(null,domElement),window[funcName]=void 0,delete window[funcName]}else{var arr={};parseQueryString(options,arr),options=arr}return options},FeaxuresProto.discover=function(a){var b=this,c=0,d=0,e=new deps.Deferred;return"string"==typeof a&&(a=deps.selector(a)),each(this._features,function(a){"domready"===a.attachEvent&&c++}),each(this._features,function(f,g){"domready"===f.attachEvent&&b.attach(g,deps.selector(f.selector,a)).always(function(){d++,d===c&&e.resolveWith(b,[{feaxuresAttached:d}])})}),e.promise()},FeaxuresProto.initialize=function(){var a=this;return each(this._features,function(b,c){c.autoLoad!==!0||a._loadedFeatures[c.name]||a.load(c.name)}),deps.domReady(function(){a.discover("body"),deps.bindEvent("body","dom:changed",function(){a.discover("body")}),deps.bindEvent(window,"resize",function(){deps.triggerEvent("body","dom:changed")});var b=["click","focus","mouseover"];each(a._features,function(c,d){if(-1!==b.indexOf(c.attachEvent)){var e=c.attachEvent,f=function(b){return a.getFeatureOptionsForElement(d,b.target)===!1?!1:(b.stopPropagation(),b.preventDefault(),a.load(d).done(function(){deps.undelegateEvent("body",e+".feaxures",c.selector,f),a.attach(d,deps.selector(c.selector)),a._features[d].attachEvent="domReady",deps.triggerEvent(b.target,e)}),void 0)};deps.delegateEvent("body",e+".feaxures",c.selector,f)}})}),this},Feaxures});