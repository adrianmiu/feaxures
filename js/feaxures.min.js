/**
 * Feaxures JS - progressive enhancement, done right!
 * @license - MIT http://opensource.org/licenses/MIT
 * @copyright - Adrian Miu www.adrianmiu.ro
 */
!function(a,b){"function"==typeof define&&define.amd?define("feaxures",function(){return a.Feaxures=b()}):a.Feaxures=b()}(this,function(){"use strict";function Deferred(){this._thens=[]}var parseQueryString=function(a,b){var e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,c=String(a).replace(/^&/,"").replace(/&$/,"").split("&"),d=c.length,t=function(a){return decodeURIComponent(a.replace(/\+/g,"%20"))};for(b||(b=this.window),e=0;d>e;e++){for(n=c[e].split("="),o=t(n[0]),p=n.length<2?"":t(n[1]),"true"===p?p=!0:"false"===p?p=!1:p==parseInt(p,10)?p=parseInt(p,10):p==parseFloat(p)&&(p=parseFloat(p));" "===o.charAt(0);)o=o.slice(1);if(o.indexOf("\0")>-1&&(o=o.slice(0,o.indexOf("\0"))),o&&"["!==o.charAt(0)){for(r=[],q=0,f=0;f<o.length;f++)if("["!==o.charAt(f)||q){if("]"===o.charAt(f)&&q&&(r.length||r.push(o.slice(0,q-1)),r.push(o.substr(q,f-q)),q=0,"["!==o.charAt(f+1)))break}else q=f+1;for(r.length||(r=[o]),f=0;f<r[0].length&&(m=r[0].charAt(f),(" "===m||"."===m||"["===m)&&(r[0]=r[0].substr(0,f)+"_"+r[0].substr(f+1)),"["!==m);f++);for(j=b,f=0,s=r.length;s>f;f++)if(o=r[f].replace(/^['"]/,"").replace(/['"]$/,""),k=f!==r.length-1,i=j,""!==o&&" "!==o||0===f)j[o]===l&&(j[o]={}),j=j[o];else{g=-1;for(h in j)j.hasOwnProperty(h)&&+h>g&&h.match(/^\d+$/g)&&(g=+h);o=g+1}i[o]=p}}},StringProto=String.prototype,ArrayProto=Array.prototype,ObjectProto=Object.prototype,slice=ArrayProto.slice,nativeForEach=ArrayProto.forEach,each=function(a,b,c){if(null!=a)if(nativeForEach&&a.forEach===nativeForEach)a.forEach(b,c);else if(a.length===+a.length){for(var d=0,e=a.length;e>d;d++)if(b.call(c,a[d],d,a)==={})return}else for(var f in a)if(ObjectProto.hasOwnProperty.call(a,f)&&b.call(c,a[f],f,a)==={})return},extend=function(a){return each(slice.call(arguments,1),function(b){if(b)for(var c in b)a[c]=b[c]}),a},trim=function(a){return StringProto.trim?StringProto.trim.call(a):a.replace(/^\s\s*/,"").replace(/\s\s*$/,"")},globalEval=function(a){a=trim(a),a&&(window.execScript||function(a){window.eval.call(window,a)})(a)};Deferred.prototype={then:function(a,b){return this._thens.push({resolve:a,reject:b}),this},done:function(a){return this.then(a,null)},fail:function(a){return this.then(null,a)},always:function(a){return this.then(a,a)},promise:function(){var a=this,b={done:function(){return a.done.apply(a,arguments)},fail:function(){return a.fail.apply(a,arguments)},always:function(){return a.always.apply(a,arguments)}};return b},resolve:function(a){this._complete("resolve",a)},resolveWith:function(a,b){this._complete("resolve",b,a)},reject:function(a){this._complete("reject",a)},rejectWith:function(a,b){this._complete("reject",b,a)},_complete:function(a,b,c){this.then="resolve"===a?function(a){a(b)}:function(a,c){c(b)},this.resolve=this.reject=function(){throw new Error("Promise already completed.")};for(var d,e=0;d=this._thens[e++];)d[a]&&d[a].call(c||null,b);delete this._thens}};var isObject=function(a){return a===Object(a)},isArray=Array.isArray||function(a){return"[object Array]"==toString.call(a)},_load=window.require,$=window.jQuery||window.zepto||window.Sizzle||window.ender,Feaxures=function(a){return this._events=$(document),this._loadedFeatures={},this._features={},this._config={},this.config(a),this},FeaxuresProto=Feaxures.prototype;return FeaxuresProto.on=function(a,b){return this._events.on(a,b),this},FeaxuresProto.one=function(a,b){return this._events.one(a,b),this},FeaxuresProto.off=function(a,b){return this._events.off(a,b),this},FeaxuresProto.trigger=function(){this.log('Event "'+arguments[0].type+'" was called'),this._events.trigger.apply(this._events,arguments)},FeaxuresProto.config=function(a){if("string"==typeof a){if(1===arguments.length)return this._config[a]||!1;this._config[a]=arguments[1]}else{if(void 0===a)return this._config;this._config=extend(this._config,a)}return this},FeaxuresProto.log=function(){this.config("debug")&&"function"==typeof console.log&&console.log.apply(console,arguments)},FeaxuresProto.isRegistered=function(a){return a&&this._features[a]?!0:!1},FeaxuresProto.register=function(a,b){b=extend({autoLoad:!1,selector:"[data-fxr-"+a+"]",files:[],defaults:{},attachEvent:"domready",attachCondition:!0,detach:null,onLoad:null,onLoadError:null,onAttach:null,onDetach:null},b,{name:a}),"function"==typeof b.onLoad&&this.on("load:"+a,b.onLoad),"function"==typeof b.onLoadError&&this.on("loadError:"+a,b.onLoadError),"function"==typeof b.onAttach&&this.on("attach:"+a,b.onAttach),"function"==typeof b.onDetach&&this.on("detach:"+a,b.onDetach),this._features[a]=b},FeaxuresProto.isLoaded=function(a){return this._loadedFeatures[a]?!0:!1},FeaxuresProto.load=function(a,b){var c=this,d=new Deferred;if(!this.isRegistered(a))return this.log("Feaxure "+a+" is not registered"),d.rejectWith(c,["Feaxure "+a+" is not registered"]),d.promise();var e=this._features[a];return"function"==typeof e.files&&(e.files=e.files.call(this)),isArray(e.files)?("function"==typeof b&&d.done(b),this._loadedFeatures[a]===!0?(d.resolveWith(c),d.promise()):this._loadedFeatures[a]===!1?(d.rejectWith(c),d.promise()):(d.done(function(){if(this._loadedFeatures[a]!==!0){this._loadedFeatures[a]=!0,c.log("Feaxure "+a+" was loaded");var b=$.Event("load");b.feature=a,c.trigger(b),b=$.Event("load:"+a),b.feature=a,c.trigger(b)}}),d.fail(function(){if(this._loadedFeatures[a]!==!1){this._loadedFeatures[a]=!1,c.log("Error loading feaxure "+a);var d=$.Event("loadError");d.feature=a,c.trigger(d),d=$.Event("loadError:"+a),d.feature=a,c.trigger(d)}}),_load(e.files,function(){d.resolveWith(c,["Feaxure "+a+" was loaded"])},function(b){c.log("Error loading feaxure "+a,b),d.rejectWith(c,[b])}),d.promise())):(this.log('The feaxure "'+a+'" does not have a valid list of dependencies'),d.rejectWith(c,['The feaxure "'+a+'" does not have a valid list of dependencies']),d.promise())},FeaxuresProto._detachFromElement=function(a,b){var c=this,d=$(b),e=this._features[a],f=!1;if(f="function"==typeof e.attachCondition&&"function"==typeof e.detach&&0==e.attachCondition.call(e,b)){e.detach.call(this,b),d.data("fxr."+a,null),this.log("Feaxure "+a+" was applied to element",b),$("body").off("dom:changed",function(){c._detachFromElement(a,b)});var g=$.Event("detach:"+a);g.element=b,g.feature=a,this.trigger(g),g=$.Event("detach"),g.element=b,g.feature=a,this.trigger(g)}},FeaxuresProto._attachToElement=function(a,b){var c=this,d=$(b),e=this._features[a],f="function"==typeof e.defaults?e.defaults.call(c,b):e.defaults,g=d.attr("data-fxr-"+a),h=null!==d.data("fxr."+a)&&void 0!==d.data("fxr."+a);if(!h){var i="function"==typeof e.attachCondition?e.attachCondition.call(e,b):e.attachCondition,j="function"==typeof e.attachCondition&&"function"==typeof e.detach;if(i&&(g=this.getFeatureOptionsForElement(a,b),g!==!1)){g=extend({},f,g),e.attach.call(this,b,g),d.data("fxr."+a,g),this.log("Feaxure "+a+" was applied to element",b),j&&$("body").on("dom:changed",function(){c._detachFromElement(a,b)});var k=$.Event("attach:"+a);k.element=b,k.feature=a,k.options=g,this.trigger(k),k=$.Event("attach"),k.element=b,k.feature=a,k.options=g,this.trigger(k)}}},FeaxuresProto.attach=function(a,b){var c=this,d=this._features[a],e=0,f=this.load(a),g=new Deferred;return d.attach&&"function"==typeof d.attach?!b.length||b.length<1?(g.done(function(a){c.log(a)}),g.resolve('Feaxure "'+a+'" has no elements to be applied to.'),g.promise()):(each(b,function(b){var f=c.getFeatureOptionsForElement(a,b);f!==!1&&e++}),0===e?(g.done(function(a){c.log(a)}),g.resolveWith(c,['Feaxure "'+a+'" has no elements to be applied to.']),g.promise()):(f.done(function(){each(b,function(b){c._attachToElement(a,b)}),g.resolveWith(c,[{feaxureName:a}])}),g.promise())):(g.fail(function(a){c.log(a)}),g.rejectWith(c,['Feaxure "'+a+'" does not have an attach() method.']),g.promise())},FeaxuresProto.getFeatureOptionsForElement=function(feature,domElement){var options=$(domElement).attr("data-fxr-"+feature);if("false"===options)return!1;if("true"===options||""===options)return{};if("#"==options.substr(0,1)&&(options=$(options).text()),options=$.trim(options),"{"==options.substr(0,1)){var o={};eval("o = "+options+";"),options=o}else if("function"==options.substr(0,8)){var funcName="_tmpFunc"+Math.floor(1e6*Math.random());if(globalEval("var "+funcName+" = "+options),"function"!=typeof window[funcName])return self.log("value could not be converted into a function: "+options),!1;options=window[funcName].call(null,domElement),window[funcName]=void 0,delete window[funcName]}else{var arr={};parseQueryString(options,arr),options=arr}return options},FeaxuresProto.discover=function(a){var b=this,c=0,d=0,e=new Deferred;return"string"==typeof a&&(a=$(a)),each(this._features,function(a){"domready"===a.attachEvent&&c++}),each(this._features,function(f,g){"domready"===f.attachEvent&&b.attach(g,$(f.selector,a)).always(function(){d++,d===c&&e.resolveWith(b,[{feaxuresAttached:d}])})}),e.promise()},FeaxuresProto.initialize=function(){var a=this;return each(this._features,function(b,c){c.autoLoad!==!0||a._loadedFeatures[c.name]||a.load(c.name)}),jQuery(function(){a.discover("body"),jQuery("body").on("dom:changed",function(){a.discover("body")}),jQuery(window).on("resize",function(){jQuery("body").trigger("dom:changed")}),each(a._features,function(b,c){each(["click","focus","mouseover"],function(d,e){e===c.attachEvent&&$("body").on(e+".feaxures",c.selector,function(d){if(a.getFeatureOptionsForElement(b,d.currentTarget)!==!1){d.stopPropagation(),d.preventDefault();var g=$(c.selector).not($(d.currentTarget));a.attach(b,$(d.currentTarget)),a.one("attach:"+b,function(){$("body").off(e+".feaxures",c.selector,d.handler),$(d.target).trigger(e),a.attach(b,g)})}})})})}),this},Feaxures});